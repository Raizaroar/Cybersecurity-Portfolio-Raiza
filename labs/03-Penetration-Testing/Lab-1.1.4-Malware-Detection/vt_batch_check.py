#!/usr/bin/env python3
"""
VirusTotal Batch Hash Checker
Author: Raiza Rosas
Purpose: Analyze multiple file hashes against VirusTotal
"""

import requests
import json
import time

# Configuration

API_KEY = "88b6840671a36d8aa90707c920c2fe86e7e001aa6969a74e67e3f3cee8bd5793"

BASE_URL = "https://www.virustotal.com/api/v3/files/"

# Sample hashes to check

hashes = [
    "ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa",  # WannaCry
    "d8e5d1683f21a14ea0c70ca7e7d61698cd32ee8c80f0f85c2bce5e02d36a7ecd",  # Locky
]

def check_hash(file_hash):
    """Query VirusTotal API for file hash"""
    headers = {
        "x-apikey": API_KEY
    }
    
    url = f"{BASE_URL}{file_hash}"
    
    try:
        response = requests.get(url, headers=headers)
        
        if response.status_code == 200:
            data = response.json()
            stats = data['data']['attributes']['last_analysis_stats']
            
            # Calculate detection ratio
            malicious = stats.get('malicious', 0)
            total = sum(stats.values())
            detection_ratio = f"{malicious}/{total}"
            
            # Determine verdict
            if malicious > (total * 0.1):  # More than 10% detect as malicious
                verdict = "MALICIOUS"
            elif malicious > 0:
                verdict = "SUSPICIOUS"
            else:
                verdict = "CLEAN"
            
            print(f"\nHash: {file_hash[:32]}...")
            print(f"Detection: {detection_ratio}")
            print(f"Verdict: {verdict}")
            
            return data
            
        elif response.status_code == 404:
            print(f"\n Hash not found in VirusTotal: {file_hash[:32]}...")
            return None
        else:
            print(f"\n  Error {response.status_code}: {response.text}")
            return None
            
    except Exception as e:
        print(f"\n Exception: {e}")
        return None

def main():
    print("="*60)
    print("VirusTotal Batch Hash Checker")
    print("="*60)
    
    for hash_value in hashes:
        check_hash(hash_value)
        time.sleep(15)  # Rate limiting: 4 requests/minute for free tier
    
    print("\n" + "="*60)
    print("Analysis Complete")
    print("="*60)

if __name__ == "__main__":
    main();